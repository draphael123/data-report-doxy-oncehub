<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Doxy & OnceHub Reports Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <!-- Core Libraries -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
    <!-- Export Libraries -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.7.1/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-content">
                <div>
                    <h1>ğŸ“Š Doxy & OnceHub Reports Dashboard</h1>
                    <p class="subtitle">Interactive Provider Performance Reports</p>
                </div>
                <div class="header-controls">
                    <button id="themeToggle" class="icon-button" title="Toggle Dark Mode (D)">
                        <span id="themeIcon">ğŸŒ™</span>
                    </button>
                    <select id="themeSelect" class="theme-select" title="Choose Theme">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="midnight">Midnight</option>
                        <option value="ocean">Ocean</option>
                        <option value="sunset">Sunset</option>
                    </select>
                    <button id="exportBtn" class="icon-button" title="Export Data (E)">ğŸ“¥</button>
                    <button id="comparisonBtn" class="icon-button" title="Compare Weeks (C)" onclick="openComparisonModal()">ğŸ“Š</button>
                    <button id="helpBtn" class="icon-button" title="Help (?)">â“</button>
                    <button id="settingsBtn" class="icon-button" title="Settings (S)">âš™ï¸</button>
                </div>
            </div>
        </header>

        <nav class="tabs">
            <button class="tab-button active" data-tab="Doxy Visits">Doxy Visits</button>
            <button class="tab-button" data-tab="Oncehub Report - Visit Type Dat">Visit Type Data</button>
            <button class="tab-button" data-tab="Oncehub Report - Number of Visi">Number of Visits</button>
            <button class="tab-button" data-tab="Oncehub - Program Grouped">Program Grouped</button>
            <button class="tab-button" data-tab="Gusto Hours ">Gusto Hours</button>
            <button class="tab-button" data-tab="Doxy - Over 20 minutes">Doxy 20+ Minutes</button>
            <button class="tab-button" data-tab="Oncehub Pivot Program">Oncehub Pivot</button>
            <button class="tab-button" data-tab="Program Grouped">Program Details</button>
            <button class="tab-button" data-tab="Program Pivot">Program Pivot</button>
        </nav>

        <div class="analytics-section" id="analyticsSection">
            <!-- Analytics cards will be inserted here -->
        </div>

        <div class="charts-section" id="chartsSection">
            <!-- Charts will be inserted here -->
        </div>

        <!-- Weekly Averages Section -->
        <div class="weekly-averages-section" id="weeklyAveragesSection" style="display: none;">
            <div class="section-header">
                <h3>ğŸ“ˆ Week-by-Week Averages</h3>
                <p>Average visits per provider for each week</p>
            </div>
            <div class="weekly-averages-grid" id="weeklyAveragesGrid">
                <!-- Weekly average cards will be inserted here -->
            </div>
        </div>

        <!-- Smart Insights Panel -->
        <div class="insights-panel" id="insightsPanel" style="display: none;">
            <div class="insights-header">
                <h3>ğŸ’¡ Smart Insights</h3>
                <button class="insights-close" onclick="closeInsights()">Ã—</button>
            </div>
            <div class="insights-content" id="insightsContent">
                <!-- Insights will be generated here -->
            </div>
        </div>

        <!-- Comparison Mode Toggle -->
        <div class="view-mode-toggle" id="viewModeToggle">
            <button class="view-mode-btn active" data-mode="actual" onclick="switchViewMode('actual')">
                ğŸ“Š Actual Numbers
            </button>
            <button class="view-mode-btn" data-mode="percent" onclick="switchViewMode('percent')">
                ğŸ“ˆ % of Goal
            </button>
            <button class="view-mode-btn" data-mode="delta" onclick="switchViewMode('delta')">
                ğŸ“‰ vs Last Week
            </button>
            <button class="view-mode-btn" data-mode="average" onclick="switchViewMode('average')">
                ğŸ“ vs Average
            </button>
        </div>

        <!-- Monthly Summary -->
        <div class="monthly-summary" id="monthlySummary" style="display: none;">
            <div class="monthly-header">
                <h2>ğŸ“… Monthly Overview</h2>
                <div class="month-period" id="monthPeriod"></div>
            </div>
            <div class="monthly-stats">
                <div class="monthly-stat-card">
                    <div class="stat-icon">ğŸ“Š</div>
                    <div class="stat-content">
                        <div class="stat-label">Total This Month</div>
                        <div class="stat-value" id="monthlyTotal">-</div>
                        <div class="stat-detail" id="monthlyWeeks"></div>
                    </div>
                </div>
                <div class="monthly-stat-card">
                    <div class="stat-icon">ğŸ“ˆ</div>
                    <div class="stat-content">
                        <div class="stat-label">Weekly Average</div>
                        <div class="stat-value" id="weeklyAverage">-</div>
                        <div class="stat-detail" id="weeklyTrend"></div>
                    </div>
                </div>
                <div class="monthly-stat-card">
                    <div class="stat-icon">ğŸ‘¥</div>
                    <div class="stat-content">
                        <div class="stat-label">Avg per Provider</div>
                        <div class="stat-value" id="monthlyProviderAvg">-</div>
                        <div class="stat-detail" id="providerCount"></div>
                    </div>
                </div>
                <div class="monthly-stat-card">
                    <div class="stat-icon">ğŸ¯</div>
                    <div class="stat-content">
                        <div class="stat-label">Monthly Projection</div>
                        <div class="stat-value" id="monthlyProjection">-</div>
                        <div class="stat-detail" id="projectionDetail"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Summary Cards -->
        <div class="summary-cards" id="summaryCards">
            <div class="summary-card">
                <div class="card-icon">ğŸ“Š</div>
                <div class="card-content">
                    <div class="card-label">Total Visits</div>
                    <div class="card-value" id="totalVisitsValue">-</div>
                    <div class="card-change" id="totalVisitsChange"></div>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon">ğŸ†</div>
                <div class="card-content">
                    <div class="card-label">Top Performer</div>
                    <div class="card-value" id="topPerformerValue">-</div>
                    <div class="card-subtext" id="topPerformerVisits"></div>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon">ğŸ¯</div>
                <div class="card-content">
                    <div class="card-label">Active Programs</div>
                    <div class="card-value" id="activeProgramsValue">-</div>
                    <div class="card-subtext" id="programsList"></div>
                </div>
            </div>
            <div class="summary-card">
                <div class="card-icon">ğŸ‘¥</div>
                <div class="card-content">
                    <div class="card-label">Active Providers</div>
                    <div class="card-value" id="activeProvidersValue">-</div>
                    <div class="card-change" id="activeProvidersChange"></div>
                </div>
            </div>
        </div>

        <!-- Quick Filters -->
        <div class="quick-filters" id="quickFilters">
            <button class="quick-filter-btn active" data-filter="all" onclick="applyQuickFilter('all')">
                ğŸ“‹ All Data
            </button>
            <button class="quick-filter-btn" data-filter="active" onclick="applyQuickFilter('active')">
                âœ… Active Only
            </button>
            <button class="quick-filter-btn" data-filter="top10" onclick="applyQuickFilter('top10')">
                ğŸŒŸ Top 10
            </button>
            <button class="quick-filter-btn" data-filter="growth" onclick="applyQuickFilter('growth')">
                ğŸ“ˆ Growth
            </button>
            <button class="quick-filter-btn" data-filter="declining" onclick="applyQuickFilter('declining')">
                âš ï¸ Declining
            </button>
        </div>

        <div class="controls">
            <div class="search-box">
                <input type="text" id="searchInput" placeholder="ğŸ” Search across all columns..." />
            </div>
            <button class="filter-toggle-btn" onclick="toggleAdvancedFilters()">
                <span>ğŸ” Filters</span>
            </button>
            <div class="info">
                <span id="rowCount">Loading...</span>
            </div>
        </div>

        <div class="advanced-filters" id="advancedFilters">
            <div class="filters-header">
                <h3>Advanced Filters</h3>
                <div class="filters-actions">
                    <button onclick="clearAllFilters()" class="filter-btn">Clear All</button>
                    <button onclick="saveFilterPreset()" class="filter-btn">Save Preset</button>
                    <select id="filterPresets" onchange="loadFilterPreset(this.value)">
                        <option value="">Load Preset...</option>
                    </select>
                </div>
            </div>
            <div id="filterOptions" class="filter-options">
                <!-- Dynamic filter options will be inserted here -->
            </div>
        </div>

        <div class="table-container">
            <div id="tableWrapper">
                <p class="loading">Loading data...</p>
            </div>
        </div>

        <footer>
            <p>Data last updated: <span id="lastUpdate"></span></p>
        </footer>
    </div>

    <!-- Export Modal -->
    <div id="exportModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>ğŸ“¥ Export Data</h2>
                <button class="close-btn" onclick="closeModal('exportModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="export-options">
                    <button class="export-btn" onclick="ExportManager.exportToPDF()">
                        <span class="export-icon">ğŸ“„</span>
                        <span class="export-label">Export to PDF</span>
                        <span class="export-desc">Full report with charts</span>
                    </button>
                    <button class="export-btn" onclick="ExportManager.exportToExcel()">
                        <span class="export-icon">ğŸ“Š</span>
                        <span class="export-label">Export to Excel</span>
                        <span class="export-desc">Spreadsheet format</span>
                    </button>
                    <button class="export-btn" onclick="ExportManager.exportToCSV()">
                        <span class="export-icon">ğŸ“‹</span>
                        <span class="export-label">Export to CSV</span>
                        <span class="export-desc">Comma-separated values</span>
                    </button>
                    <button class="export-btn" onclick="ExportManager.exportCharts()">
                        <span class="export-icon">ğŸ“ˆ</span>
                        <span class="export-label">Export Charts</span>
                        <span class="export-desc">Save as images</span>
                    </button>
                    <button class="export-btn" onclick="ExportManager.copyToClipboard()">
                        <span class="export-icon">ğŸ“‹</span>
                        <span class="export-label">Copy to Clipboard</span>
                        <span class="export-desc">Quick data copy</span>
                    </button>
                    <button class="export-btn" onclick="window.print()">
                        <span class="export-icon">ğŸ–¨ï¸</span>
                        <span class="export-label">Print</span>
                        <span class="export-desc">Print-optimized view</span>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Comparison Modal -->
    <div id="comparisonModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2>ğŸ“Š Week Comparison</h2>
                <button class="close-btn" onclick="closeModal('comparisonModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="comparison-controls">
                    <div>
                        <label>Week 1:</label>
                        <select id="week1Select"></select>
                    </div>
                    <div>
                        <label>Week 2:</label>
                        <select id="week2Select"></select>
                    </div>
                    <button onclick="loadComparison()" class="btn-primary">Compare</button>
                </div>
                <div id="comparisonContent" class="comparison-content">
                    <!-- Comparison data will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Provider Detail Modal -->
    <div id="providerModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="providerModalTitle">ğŸ‘¤ Provider Details</h2>
                <button class="close-btn" onclick="closeModal('providerModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="providerContent" class="provider-content">
                    <!-- Provider details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Week Detail Modal -->
    <div id="weekModal" class="modal">
        <div class="modal-content large">
            <div class="modal-header">
                <h2 id="weekModalTitle">ğŸ“… Week Details</h2>
                <button class="close-btn" onclick="closeModal('weekModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div id="weekContent" class="week-content">
                    <!-- Week details will be loaded here -->
                </div>
            </div>
        </div>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>âš™ï¸ Settings</h2>
                <button class="close-btn" onclick="closeModal('settingsModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="settings-section">
                    <h3>Display Density</h3>
                    <div class="radio-group">
                        <label><input type="radio" name="density" value="compact" onchange="SettingsManager.setDensity('compact')"> Compact</label>
                        <label><input type="radio" name="density" value="comfortable" checked onchange="SettingsManager.setDensity('comfortable')"> Comfortable</label>
                        <label><input type="radio" name="density" value="spacious" onchange="SettingsManager.setDensity('spacious')"> Spacious</label>
                    </div>
                </div>
                <div class="settings-section">
                    <h3>Animations</h3>
                    <label class="switch">
                        <input type="checkbox" id="animationsToggle" checked onchange="SettingsManager.toggleAnimations(this.checked)">
                        <span class="slider"></span>
                        Enable animations
                    </label>
                </div>
                <div class="settings-section">
                    <h3>Auto-refresh</h3>
                    <label class="switch">
                        <input type="checkbox" id="autoRefreshToggle" onchange="SettingsManager.toggleAutoRefresh(this.checked)">
                        <span class="slider"></span>
                        Auto-refresh data
                    </label>
                </div>
                <div class="settings-section">
                    <h3>Rows per page</h3>
                    <select id="rowsPerPage" onchange="SettingsManager.setRowsPerPage(this.value)">
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100" selected>100</option>
                        <option value="250">250</option>
                        <option value="-1">All</option>
                    </select>
                </div>
            </div>
        </div>
    </div>

    <!-- Help Modal -->
    <div id="helpModal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h2>â“ Help & Keyboard Shortcuts</h2>
                <button class="close-btn" onclick="closeModal('helpModal')">&times;</button>
            </div>
            <div class="modal-body">
                <div class="help-section">
                    <h3>âŒ¨ï¸ Keyboard Shortcuts</h3>
                    <div class="shortcuts-grid">
                        <div class="shortcut-item"><kbd>D</kbd> Toggle Dark Mode</div>
                        <div class="shortcut-item"><kbd>E</kbd> Export Data</div>
                        <div class="shortcut-item"><kbd>S</kbd> Settings</div>
                        <div class="shortcut-item"><kbd>?</kbd> Help</div>
                        <div class="shortcut-item"><kbd>/</kbd> Focus Search</div>
                        <div class="shortcut-item"><kbd>Esc</kbd> Close Modals</div>
                        <div class="shortcut-item"><kbd>1-9</kbd> Switch Tabs</div>
                        <div class="shortcut-item"><kbd>Ctrl/Cmd + P</kbd> Print</div>
                    </div>
                </div>
                <div class="help-section">
                    <h3>ğŸ¨ Features</h3>
                    <ul class="feature-list">
                        <li><strong>Search:</strong> Type to filter across all columns</li>
                        <li><strong>Sort:</strong> Click column headers to sort</li>
                        <li><strong>Charts:</strong> Hover for interactive tooltips</li>
                        <li><strong>Export:</strong> Download data in multiple formats</li>
                        <li><strong>Themes:</strong> Choose from 5 different themes</li>
                        <li><strong>Dark Mode:</strong> Easy on the eyes</li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <!-- Floating Action Button -->
    <div class="fab-container">
        <button class="fab" id="fabMain" title="Quick Actions">
            <span>âš¡</span>
        </button>
        <div class="fab-menu" id="fabMenu">
            <button class="fab-item" onclick="ExportManager.exportToExcel()" title="Export to Excel">ğŸ“Š</button>
            <button class="fab-item" onclick="ExportManager.exportToPDF()" title="Export to PDF">ğŸ“„</button>
            <button class="fab-item" onclick="ExportManager.copyToClipboard()" title="Copy Data">ğŸ“‹</button>
            <button class="fab-item" onclick="window.scrollTo({top: 0, behavior: 'smooth'})" title="Scroll to Top">â¬†ï¸</button>
        </div>
    </div>

    <!-- Load main script first with data -->
    <script src="script.js"></script>
    <!-- Then load feature modules -->
    <script src="themes.js"></script>
    <script src="settings.js"></script>
    <script src="export.js"></script>
    <script src="keyboard.js"></script>
</body>
</html>

